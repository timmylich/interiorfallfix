## [Read in English](README.md)

# Что это?

Данный include позволяет раз и навсегда забыть о проблеме проваливаний игроков под пол в интерьерах, а также затяжной прогрузке, при которой игрок прибывает в заморозке.

Скрипт содержит в себе 2 основных функции:
1. **Создание статичной платформы** - перед телепортацией под игроком создается невидимая платформа, которая предотвращает проваливание под пол.
2. **Система "спасалки"** - если игрок все же начал падать после телепортации, скрипт автоматически телепортирует его обратно на место последней телепортации.

### Видео-демонстрация:
[![Watch the video](https://img.youtube.com/vi/mz9TV2BE4ww/maxresdefault.jpg)](https://youtu.be/mz9TV2BE4ww)

# Подключение

Для работы исправления достаточно просто подключить файл `InteriorFallFix.inc` в свой код.
Сделайте это после основных включений и перехватов анти-чита.
```cpp
#include <InteriorFallFix>
```

- Если в вашем моде есть заморозки при телепортации игроков между интерьерами - отключите их.

Для работоспособности генерации спасающих платформ вам необходимо вставить вызов `IFX_GeneratePlatform` в функцию, в которую при телепортацией игрока также передаётся и виртуальный мир вместе с интерьером. Обычно она называется `SetPlayerPosEx`.

Функция принимает следующие параметры:
- `playerid` - ID игрока
- `oldworld` - виртуальный мир игрока до телепортации (или -1)
- `newworld` - виртуальный мир игрока после телепортации (или -1)
- `oldint` - интерьер игрока до телепортации (или -1)
- `newint` - интерьер игрока после телепортации (или -1)
- `x, y, z` - координаты телепортации

## Дополнительные функции

### IFX_DisableAttempt()
Используйте перед телепортацией, если вам необходимо отключить попытку работы "спасалки" от падений:
```cpp
IFX_DisableAttempt();
// Ваша телепортация
SetPlayerPos(playerid, x, y, z);
```

### Автоматический перехват SetPlayerPos
Скрипт автоматически перехватывает функцию `SetPlayerPos`, поэтому дополнительная настройка не требуется. При каждом вызове `SetPlayerPos` скрипт автоматически отслеживает телепортации и сохраняет координаты для последующей проверки падений.

# Настройка
Во включении есть ряд определений, которые позволяют его настраивать.
Для того, чтобы изменить какое-то значение нужно определить его перед подключением включения, либо отредактировать его внутри включения.

Время, в течении которого после последней телепортации скрипт будет проверять падает ли игрок в миллисекундах:
```cpp
#define IFX_FixTime 7000
```

Время, на которое будет создаваться статичная платформа под игроком в интерьере (в миллисекундах):
```cpp
#define IFX_InteriorPlatformTime 4000
```

Время, на которое будет создаваться статичная платформа под игроком в экстерьере (в миллисекундах):
```cpp
#define IFX_ExteriorPlatformTime 2000
```

Откуда брать информацию о том, в каком интерьере находится игрок:
```cpp
#define IFX_GetPlayerInterior(%0) GetPlayerInterior(%0)
```
Рекомендуется установить какую-нибудь свою функцию или переменную для грамотной работы с античитом во избежание несанкционированного перемещения между интерьерами (если конечно ваш античит не перехватывает `GetPlayerInterior`).

Задержка между проверками скрипта в OnPlayerUpdate в миллисекундах:
```cpp
#define IFX_PlayerUpdateCD 250
```
Меньше - чаще проверки и ниже производительность.

Смещение по координате Z вниз, по достижению которого скрипт посчитает игрока падающим в бездну:
```cpp
#define IFX_FallZShift 0.2
```

### Авторы


**timmylich. | [ВКонтакте](vk.com/timmylich) | [Telegram](t.me/timmylich) | [Discord](http://discordapp.com/users/523177185062682685)**

**Изначально разработано для [Brentwood Project](bw-p.ru)**